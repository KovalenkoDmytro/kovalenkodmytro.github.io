//here is a general function to check selector exists and to invoke on choose viewport(mobile: - mobile and tablet devices/ desktop - PC / all - to invoke on all devices)

const dataWorks = {
    "belike": [
        {
            "src": "/assets/img/works/belike/1.webp",
            "alt": "belike",
            "width": "1359",
            "height": "7834"
        },
        {
            "src": "/assets/img/works/belike/2.webp",
            "alt": "belike",
            "width": "2552",
            "height": "4041"
        },
        {
            "src": "/assets/img/works/belike/3.webp",
            "alt": "belike",
            "width": "2552",
            "height": "5212"
        },
        {
            "src": "/assets/img/works/belike/4.webp",
            "alt": "belike",
            "width": "2552",
            "height": "5524"
        }
    ],
    "comel": [
        {
            "src": "/assets/img/works/comel/1.webp",
            "alt": "comel",
            "width": "1792",
            "height": "4048"
        },
        {
            "src": "/assets/img/works/comel/2.webp",
            "alt": "comel",
            "width": "1504",
            "height": "5569"
        },
        {
            "src": "/assets/img/works/comel/3.webp",
            "alt": "comel",
            "width": "1492",
            "height": "5192"
        }
    ],
    "eviso": [
        {
            "src": "/assets/img/works/eviso/1.webp",
            "alt": "comel",
            "width": "2560",
            "height": "6732"
        },
        {
            "src": "/assets/img/works/eviso/2.webp",
            "alt": "comel",
            "width": "1744",
            "height": "6067"
        },
        {
            "src": "/assets/img/works/eviso/3.webp",
            "alt": "comel",
            "width": "1726",
            "height": "11201"
        }
    ],
    "ezebra": [
        {
            "src": "/assets/img/works/ezebra/1.webp",
            "alt": "ezebra",
            "width": "2240",
            "height": "6781"
        },
        {
            "src": "/assets/img/works/ezebra/2.webp",
            "alt": "ezebra",
            "width": "1824",
            "height": "5934"
        },
        {
            "src": "/assets/img/works/ezebra/3.webp",
            "alt": "ezebra",
            "width": "1842",
            "height": "7592"
        }
    ],
    "nextEstate": [
        {
            "src": "/assets/img/works/nextEstate/1.webp",
            "alt": "gunfire",
            "width": "2537",
            "height": "9401"
        },
        {
            "src": "/assets/img/works/nextEstate/2.webp",
            "alt": "gunfire",
            "width": "2183",
            "height": "3311"
        },
        {
            "src": "/assets/img/works/nextEstate/3.webp",
            "alt": "gunfire",
            "width": "2560",
            "height": "9079"
        },
        {
            "src": "/assets/img/works/nextEstate/4.webp",
            "alt": "gunfire",
            "width": "2560",
            "height": "2482"
        },
        {
            "src": "/assets/img/works/nextEstate/4.webp",
            "alt": "gunfire",
            "width": "2560",
            "height": "4543"
        }
    ],
    "gunfire": [
        {
            "src": "/assets/img/works/gunfire/1.webp",
            "alt": "gunfire",
            "width": "2560",
            "height": "5620"
        },
        {
            "src": "/assets/img/works/gunfire/2.webp",
            "alt": "gunfire",
            "width": "2584",
            "height": "6375"
        },
        {
            "src": "/assets/img/works/gunfire/3.webp",
            "alt": "gunfire",
            "width": "1360",
            "height": "3824"
        }
    ],
    "nizel": [
        {
            "src": "/assets/img/works/nizel/1.webp",
            "alt": "nizel",
            "width": "1510",
            "height": "5933"
        },
        {
            "src": "/assets/img/works/nizel/2.webp",
            "alt": "nizel",
            "width": "1629",
            "height": "10102"
        },
        {
            "src": "/assets/img/works/nizel/3.webp",
            "alt": "nizel",
            "width": "1545",
            "height": "4408"
        }
    ],
    "pakolorente": [
        {
            "src": "/assets/img/works/pakolorente/1.webp",
            "alt": "pakolorente",
            "width": "2002",
            "height": "5708"
        },
        {
            "src": "/assets/img/works/pakolorente/2.webp",
            "alt": "pakolorente",
            "width": "1896",
            "height": "4712"
        },
        {
            "src": "/assets/img/works/pakolorente/3.webp",
            "alt": "pakolorente",
            "width": "1979",
            "height": "8961"
        }
    ],
    "pinali": [
        {
            "src": "/assets/img/works/pinali/1.webp",
            "alt": "pinali",
            "width": "1920",
            "height": "5520"
        },
        {
            "src": "/assets/img/works/pinali/2.webp",
            "alt": "pinali",
            "width": "1273",
            "height": "3922"
        },
        {
            "src": "/assets/img/works/pinali/3.webp",
            "alt": "pinali",
            "width": "1979",
            "height": "8961"
        }
    ],
    "sollux": [
        {
            "src": "/assets/img/works/sollux/1.webp",
            "alt": "sollux",
            "width": "1286",
            "height": "9620"
        },
        {
            "src": "/assets/img/works/sollux/2.webp",
            "alt": "sollux",
            "width": "1258",
            "height": "5619"
        },
        {
            "src": "/assets/img/works/sollux/3.webp",
            "alt": "sollux",
            "width": "1342",
            "height": "16383"
        }
    ],
    "telimena": [
        {
            "src": "/assets/img/works/telimena/1.webp",
            "alt": "telimena",
            "width": "1849",
            "height": "5257"
        },
        {
            "src": "/assets/img/works/telimena/2.webp",
            "alt": "telimena",
            "width": "1716",
            "height": "4343"
        },
        {
            "src": "/assets/img/works/telimena/3.webp",
            "alt": "telimena",
            "width": "1733",
            "height": "6839"
        },
        {
            "src": "/assets/img/works/telimena/4.webp",
            "alt": "telimena",
            "width": "1713",
            "height": "4601"
        }
    ],
    "ultraupgrate": [
        {
            "src": "/assets/img/works/ultraupgrate/1.webp",
            "alt": "ultraupgrate",
            "width": "2049",
            "height": "7408"
        },
        {
            "src": "/assets/img/works/ultraupgrate/2.webp",
            "alt": "ultraupgrate",
            "width": "1566",
            "height": "7673"
        },
        {
            "src": "/assets/img/works/ultraupgrate/3.webp",
            "alt": "ultraupgrate",
            "width": "1365",
            "height": "6111"
        }
    ],
    "welleundpartner": [
        {
            "src": "/assets/img/works/welleundpartner/1.webp",
            "alt": "welleundpartner",
            "width": "2560",
            "height": "5057"
        },
        {
            "src": "/assets/img/works/welleundpartner/2.webp",
            "alt": "welleundpartner",
            "width": "2560",
            "height": "3479"
        },
        {
            "src": "/assets/img/works/welleundpartner/3.webp",
            "alt": "welleundpartner",
            "width": "2560",
            "height": "4831"
        }
    ],
    "meininger": [
        {
            "src": "/assets/img/works/meininger/0.webp",
            "alt": "meininger",
            "width": "2549",
            "height": "9174"
        },
        {
            "src": "/assets/img/works/meininger/1.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "919"
        },
        {
            "src": "/assets/img/works/meininger/2.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "919"
        },
        {
            "src": "/assets/img/works/meininger/3.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "2055"
        },
        {
            "src": "/assets/img/works/meininger/4.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "1500"
        },
        {
            "src": "/assets/img/works/meininger/5.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "956"
        },
        {
            "src": "/assets/img/works/meininger/6.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "961"
        },
        {
            "src": "/assets/img/works/meininger/7.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "1522"
        },
        {
            "src": "/assets/img/works/meininger/8.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "3481"
        },
        {
            "src": "/assets/img/works/meininger/9.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "2619"
        },
        {
            "src": "/assets/img/works/meininger/10.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "2251"
        },
        {
            "src": "/assets/img/works/meininger/11.webp",
            "alt": "meininger",
            "width": "2560",
            "height": "1869"
        },

    ]
}


const toInvoke = function (callback, view = 'all', selector) {
    if (document.querySelector(selector) !== null || document.querySelector(selector) !== undefined) {
        if (view === 'mobile' && window.innerWidth <= 979) {
            return callback()
        }
        if (view === 'desktop' && (window.innerWidth > 979)) {
            return callback()
        }
        if (view === 'all') {
            return callback()
        }
    }
}
toInvoke(() => {

    const getIP = async () => {
       return await fetch('https://api.db-ip.com/v2/free/self')
            .then(response => response.json())
    }
    const toSendData = (data)=>{
        const requestOptions = {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({'visitor': data})
        };
        fetch('/visitors.php', requestOptions)
            .then(response => response.text())
    }

    window.addEventListener("DOMContentLoaded", async () => {
        let visitor ={
            browser:navigator.userAgent,
            languages :navigator.languages,
            referrer: document.referrer,
            screenWidth : screen.availWidth,
        }

        await getIP().then(data =>
            visitor = { ...visitor, city: data.city, continent: data.continentName, country : data.countryName,  ip: data.ipAddress, province: data.stateProv })

        toSendData(visitor)
    });
}, 'all', 'main')

toInvoke(() => {
    window.addEventListener("DOMContentLoaded", () => {
        new Blazy({
            selector: '.b-lazy'
            ,
        });
    });
}, 'all', 'main')


toInvoke(() => {
    window.addEventListener("DOMContentLoaded", () => {
        particlesJS.load("particles-js", "assets/particles.json");
    });

}, 'all', '#particles-js')

/*Intro animation*/
toInvoke(() => {
    window.addEventListener("DOMContentLoaded", () => {
        const intro = document.querySelector("#intro");
        setTimeout(() => {
            intro.style.top = "-100dvh";

        }, 1500);
    });

}, 'desktop', '#intro')


/*Auto write text*/
toInvoke(() => {

    const app = document.getElementById("autoWrite");
    new Typewriter(app, {
        strings: ["Full-stack developer"],
        loop: true,
        autoStart: true,
    });
}, 'desktop', '#autoWrite')

// to add animation while content appears on the page
toInvoke(() => {
    const sr = ScrollrevealMin({
        origin: "top",
        distance: "40px",
        duration: 2000,
    });

    sr.reveal(".about__img", {});
    sr.reveal(".about__content", {delay: 400});
    sr.reveal(".skills__wrapper", {delay: 400, cleanup: false});
    sr.reveal(".work__items .work__item", {interval: 200});

}, 'desktop', 'main')

// to show galery when click on work thile 
toInvoke(() => {

    const showWorkButtons = document.querySelectorAll('#works .work__item .galery .btn')

    showWorkButtons.forEach(function (button) {
        button.addEventListener('click', (event) => {
            const galleryName = event.target.getAttribute('data-gallery')
            const dataSource = dataWorks[`${galleryName}`]
            const options = {
                dataSource: dataSource,
                mouseMovePan: true,
                wheelToZoom: true,
                pswpModule: PhotoSwipe,
            };

            options.index = 0; // defines start slide index
            const pswp = new PhotoSwipe(options);
            pswp.init();

        })
    })
}, 'all', '#works')


// set active for navigation link
toInvoke(() => {

    const navListItems = document.querySelectorAll('#navlist .nav_link')

    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            const intersecting = entry.isIntersecting
            const id = entry.target.getAttribute('id')

            let activeTab = Array.from(navListItems).filter(item => {
                const href = item.getAttribute('data-href')
                if (href === `#${id}`) {
                    return item
                }
            })

            if (intersecting) {
                activeTab[0].classList.add('active')
            } else {
                activeTab[0].classList.remove('active')
            }

        })
    }, {
        rootMargin: "40px",
        threshold: 0.25,
    })

    const sections = document.querySelectorAll('section')
    sections.forEach(section => {
        observer.observe(section)
    })
}, 'desktop', 'main')

//smoothscroll to element
toInvoke(() => {
    const navListItems = document.querySelectorAll('#navlist .nav_link')
    let scrollOption = {duration: 700, block: '50%'}
    const scroller = new smoothScroll(scrollOption);

    navListItems.forEach(link => {
        link.addEventListener('click', function () {
            const sectionId = this.getAttribute('data-href').replace('#', '').trim();

            if (sectionId === 'works') {
                smoothScroll({yPos: document.querySelector('#works').offsetTop - 80});

            } else {
                scroller.smoothScroll({
                    toElement: document.querySelector(`section[id=${sectionId}]`)
                });
            }
        })
    })
}, 'all', 'main')

//to show mobileMenu
toInvoke(() => {
    const menuBtnOpen = document.querySelector('#navToggle')
    const menuBtnClose = document.querySelector('#closeNavMenu')
    const html = document.querySelector('html')
    const navigationLinks = document.querySelectorAll('#navlist .nav_link')

    menuBtnOpen.addEventListener('click', () => {
        html.classList.add('_showMobileNav')
    })
    menuBtnClose.addEventListener('click', () => {
        html.classList.remove('_showMobileNav')
    })

    navigationLinks.forEach(link => {
        link.addEventListener('click', () => {
            html.classList.remove('_showMobileNav')
        })
    })

}, 'mobile', '#navToggle')
























